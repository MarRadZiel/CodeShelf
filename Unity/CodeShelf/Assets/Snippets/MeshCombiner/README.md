# 🧩 Mesh Combiner
[MeshCombiner](MeshCombiner.cs) is a Unity utility for combining multiple meshes into a single mesh, grouping submeshes by material to reduce draw calls while preserving correct rendering order.  
It works both in the Unity Editor (with a context menu command) and at runtime via code, making it useful for both scene optimization and procedural generation workflows.

## 💡 Why use this
Every unique material in Unity usually means a separate draw call. By grouping meshes that share the same material into one combined mesh, you can significantly reduce draw calls and improve rendering performance — especially for static geometry.

## ✨ Features
- Combine multiple meshes into a single mesh asset  
- Group by material to minimize draw calls  
- Transform geometry into the local space of a specified root  
- Optional lightmap UV generation *(Editor only)*  
- Optional mesh optimization *(Editor only)*  
- Handles multi‑submesh meshes safely by extracting submeshes when needed  
- Editor menu integration via `GameObject` context menu

## 🚀 Getting started

### **From the Unity Editor**
1. Select a `GameObject` in the hierarchy that contains child objects with `MeshFilter` + `Renderer` components.
2. Go to `GameObject → MeshCombiner → Combine Meshes`.
3. Choose a save location for the generated mesh asset.
4. Optionally, initialize the selected `GameObject` with the generated mesh and materials.

### **From Code**
```csharp
using UnityEngine;

public class Example : MonoBehaviour
{
    public Transform root;
    public MeshFilter[] meshFilters;

    void Start()
    {
        Material[] materials;
        Mesh combined = MeshCombiner.CombineMeshes(
            root,
            meshFilters,
            out materials,
            generateLightmapUVs: true,
            optimizeMesh: true
        );

        // Assign to a MeshFilter / MeshRenderer
        var meshFilter = gameObject.AddComponent<MeshFilter>();
        var meshRenderer = gameObject.AddComponent<MeshRenderer>();
        meshFilter.sharedMesh = combined;
        meshRenderer.sharedMaterials = materials;
    }
}
```

## 📌 Method Signature

```csharp
public static Mesh CombineMeshes(
    Transform targetTransform,
    IEnumerable<MeshFilter> meshFilters,
    out Material[] combinedMaterials,
    bool generateLightmapUVs = true,
    bool optimizeMesh = true
)
```

Parameters:
- `targetTransform` — Root transform for world‑to‑local conversion
- `meshFilters` — Mesh filters to combine (meshes must be readable)
- `combinedMaterials` — Output array of materials for the combined mesh
- `generateLightmapUVs` — *(Editor only)* Generate secondary UVs for lightmapping
- `optimizeMesh` — *(Editor only)* Run Unity’s mesh optimization

Returns:  
A new `Mesh` containing the combined geometry, or `null` if parameters are invalid or any mesh is unreadable.

## 🎮 Sample Scene

A sample scene [`MeshCombinerSample.unity`](Sample/MeshCombinerSample.unity) is included to demonstrate the performance impact of mesh combining.

What it does:
- The camera automatically loops through the scene.
- Press `Space` to toggle between:
  - Multiple meshes — original uncombined scene.
  - Single combined mesh — optimized version generated by MeshCombiner.
- A UI text displays real‑time rendering statistics (e.g., draw calls, framerate) so you can compare performance instantly.

Environment source:  
The scene is built using the free asset: [`RPG/FPS Game Assets for PC/Mobile (Industrial Set v3.0)`](https://assetstore.unity.com/packages/3d/environments/industrial/rpg-fps-game-assets-for-pc-mobile-industrial-set-v3-0-101429)

How to run it:
1. Open `MeshCombinerSample.unity` in Unity.
2. Enter Play Mode.
3. Watch the camera loop and press `Space` to switch between modes.
4. Observe the stats in the top‑left corner of the screen.

## ⚠️ Notes & Limitations

- **Mesh Readability** — All meshes must have *Read/Write Enabled* in import settings.
- **Editor‑only features** — Lightmap UV generation and mesh optimization are only available in the Unity Editor.
- **Material slots** — If a renderer has fewer materials than submeshes, the last valid material is reused for remaining submeshes.
- **Null materials** — Submeshes with no valid material are skipped.

---

✅ Samples tested with Unity 6000.0 LTS